{"version":3,"file":"isDateTimestamp.js","names":["isDateTimestamp","styleId","styles","options","style","Error","concat","numberFormat","BUILT_IN_DATE_NUMBER_FORMAT_IDS","indexOf","Number","id","dateFormat","template","smartDateParser","isDateTemplate","DATE_FORMAT_WEIRD_PREFIX","DATE_FORMAT_WEIRD_POSTFIX","toLowerCase","replace","tokens","split","_iterator","_createForOfIteratorHelperLoose","_step","done","token","value","DATE_TEMPLATE_TOKENS"],"sources":["../../source/read/isDateTimestamp.js"],"sourcesContent":["// XLSX does have \"d\" type for dates, but it's not commonly used.\r\n// Instead, it prefers using \"n\" type for storing dates as timestamps.\r\n//\r\n// Whether a numeric value is a number or a date timestamp, it sometimes could be\r\n// detected by looking at the value \"format\" and seeing if it's a date-specific one.\r\n// https://github.com/catamphetamine/read-excel-file/issues/3#issuecomment-395770777\r\n//\r\n// The list of generic numeric value \"formats\":\r\n// https://xlsxwriter.readthedocs.io/format.html#format-set-num-format\r\n//\r\nexport default function isDateTimestamp(styleId, styles, options) {\r\n  if (styleId) {\r\n    const style = styles[styleId]\r\n    if (!style) {\r\n      throw new Error(`Cell style not found: ${styleId}`)\r\n    }\r\n    if (!style.numberFormat) {\r\n      return false\r\n    }\r\n    if (\r\n      // Whether it's a \"number format\" that's conventionally used for storing date timestamps.\r\n      BUILT_IN_DATE_NUMBER_FORMAT_IDS.indexOf(Number(style.numberFormat.id)) >= 0 ||\r\n      // Whether it's a \"number format\" that uses a \"formatting template\"\r\n      // that the developer is certain is a date formatting template.\r\n      (options.dateFormat && style.numberFormat.template === options.dateFormat) ||\r\n      // Whether the \"smart formatting template\" feature is not disabled\r\n      // and it has detected that it's a date formatting template by looking at it.\r\n      (options.smartDateParser !== false && style.numberFormat.template && isDateTemplate(style.numberFormat.template))\r\n     ) {\r\n      return true\r\n    }\r\n  }\r\n}\r\n\r\n// https://hexdocs.pm/xlsxir/number_styles.html\r\nconst BUILT_IN_DATE_NUMBER_FORMAT_IDS = [14,15,16,17,18,19,20,21,22,27,30,36,45,46,47,50,57]\r\n\r\n// On some date formats, there's an \"[$-414]\" prefix.\r\n// I don't have any idea what that is.\r\n//\r\n// https://stackoverflow.com/questions/4730152/what-indicates-an-office-open-xml-cell-contains-a-date-time-value\r\n//\r\n// Examples:\r\n//\r\n// * 27 (built-in format) \"[$-404]e/m/d\"\r\n// * 164 (custom format) \"[$-414]mmmm\\ yyyy;@\"\r\n//\r\nconst DATE_FORMAT_WEIRD_PREFIX = /^\\[\\$-414\\]/\r\n\r\n// On some date formats, there's an \";@\" postfix.\r\n// I don't have any idea what that is.\r\n// Examples:\r\n//\r\n// * 164 (custom format) \"m/d/yyyy;@\"\r\n// * 164 (custom format) \"[$-414]mmmm\\ yyyy;@\"\r\n//\r\nconst DATE_FORMAT_WEIRD_POSTFIX = /;@$/\r\n\r\nfunction isDateTemplate(template) {\r\n  // Date format tokens could be in upper case or in lower case.\r\n  // There seems to be no single standard.\r\n  // So lowercase the template first.\r\n  template = template.toLowerCase()\r\n\r\n  // On some date formats, there's an \"[$-414]\" prefix.\r\n  // I don't have any idea what that is. Trim it.\r\n  template = template.replace(DATE_FORMAT_WEIRD_PREFIX, '')\r\n\r\n  // On some date formats, there's an \";@\" postfix.\r\n  // I don't have any idea what that is. Trim it.\r\n  template = template.replace(DATE_FORMAT_WEIRD_POSTFIX, '')\r\n\r\n  const tokens = template.split(/\\W+/)\r\n  for (const token of tokens) {\r\n    if (DATE_TEMPLATE_TOKENS.indexOf(token) < 0) {\r\n      return false\r\n    }\r\n  }\r\n  return true\r\n}\r\n\r\n// These tokens could be in upper case or in lower case.\r\n// There seems to be no single standard, so using lower case.\r\nconst DATE_TEMPLATE_TOKENS = [\r\n  // Seconds (min two digits). Example: \"05\".\r\n  'ss',\r\n  // Minutes (min two digits). Example: \"05\". Could also be \"Months\". Weird.\r\n  'mm',\r\n  // Hours. Example: \"1\".\r\n  'h',\r\n  // Hours (min two digits). Example: \"01\".\r\n  'hh',\r\n  // \"AM\" part of \"AM/PM\". Lowercased just in case.\r\n  'am',\r\n  // \"PM\" part of \"AM/PM\". Lowercased just in case.\r\n  'pm',\r\n  // Day. Example: \"1\"\r\n  'd',\r\n  // Day (min two digits). Example: \"01\"\r\n  'dd',\r\n  // Month (numeric). Example: \"1\".\r\n  'm',\r\n  // Month (numeric, min two digits). Example: \"01\". Could also be \"Minutes\". Weird.\r\n  'mm',\r\n  // Month (shortened month name). Example: \"Jan\".\r\n  'mmm',\r\n  // Month (full month name). Example: \"January\".\r\n  'mmmm',\r\n  // Two-digit year. Example: \"20\".\r\n  'yy',\r\n  // Full year. Example: \"2020\".\r\n  'yyyy',\r\n\r\n  // I don't have any idea what \"e\" means.\r\n  // It's used in \"built-in\" XLSX formats:\r\n  // * 27 '[$-404]e/m/d';\r\n  // * 36 '[$-404]e/m/d';\r\n  // * 50 '[$-404]e/m/d';\r\n  // * 57 '[$-404]e/m/d';\r\n  'e'\r\n];"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASA,eAAeA,CAACC,OAAO,EAAEC,MAAM,EAAEC,OAAO,EAAE;EAChE,IAAIF,OAAO,EAAE;IACX,IAAMG,KAAK,GAAGF,MAAM,CAACD,OAAO,CAAC;IAC7B,IAAI,CAACG,KAAK,EAAE;MACV,MAAM,IAAIC,KAAK,0BAAAC,MAAA,CAA0BL,OAAO,CAAE,CAAC;IACrD;IACA,IAAI,CAACG,KAAK,CAACG,YAAY,EAAE;MACvB,OAAO,KAAK;IACd;IACA;IACE;IACAC,+BAA+B,CAACC,OAAO,CAACC,MAAM,CAACN,KAAK,CAACG,YAAY,CAACI,EAAE,CAAC,CAAC,IAAI,CAAC;IAC3E;IACA;IACCR,OAAO,CAACS,UAAU,IAAIR,KAAK,CAACG,YAAY,CAACM,QAAQ,KAAKV,OAAO,CAACS,UAAW;IAC1E;IACA;IACCT,OAAO,CAACW,eAAe,KAAK,KAAK,IAAIV,KAAK,CAACG,YAAY,CAACM,QAAQ,IAAIE,cAAc,CAACX,KAAK,CAACG,YAAY,CAACM,QAAQ,CAAE,EAChH;MACD,OAAO,IAAI;IACb;EACF;AACF;;AAEA;AACA,IAAML,+BAA+B,GAAG,CAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,EAAC,EAAE,CAAC;;AAE5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMQ,wBAAwB,GAAG,aAAa;;AAE9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAMC,yBAAyB,GAAG,KAAK;AAEvC,SAASF,cAAcA,CAACF,QAAQ,EAAE;EAChC;EACA;EACA;EACAA,QAAQ,GAAGA,QAAQ,CAACK,WAAW,CAAC,CAAC;;EAEjC;EACA;EACAL,QAAQ,GAAGA,QAAQ,CAACM,OAAO,CAACH,wBAAwB,EAAE,EAAE,CAAC;;EAEzD;EACA;EACAH,QAAQ,GAAGA,QAAQ,CAACM,OAAO,CAACF,yBAAyB,EAAE,EAAE,CAAC;EAE1D,IAAMG,MAAM,GAAGP,QAAQ,CAACQ,KAAK,CAAC,KAAK,CAAC;EACpC,SAAAC,SAAA,GAAAC,+BAAA,CAAoBH,MAAM,GAAAI,KAAA,IAAAA,KAAA,GAAAF,SAAA,IAAAG,IAAA,GAAE;IAAA,IAAjBC,KAAK,GAAAF,KAAA,CAAAG,KAAA;IACd,IAAIC,oBAAoB,CAACnB,OAAO,CAACiB,KAAK,CAAC,GAAG,CAAC,EAAE;MAC3C,OAAO,KAAK;IACd;EACF;EACA,OAAO,IAAI;AACb;;AAEA;AACA;AACA,IAAME,oBAAoB,GAAG;AAC3B;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,GAAG;AACH;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA,GAAG;AACH;AACA,IAAI;AACJ;AACA,GAAG;AACH;AACA,IAAI;AACJ;AACA,KAAK;AACL;AACA,MAAM;AACN;AACA,IAAI;AACJ;AACA,MAAM;AAEN;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,CACJ"}